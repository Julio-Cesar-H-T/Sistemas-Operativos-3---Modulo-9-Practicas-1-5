sudo dnf install -y ansible sshpass python3-pip
ansible --version


sudo adduser ansible
sudo passwd ansible
sudo usermod -aG wheel ansible
sudo usermod -aG sudo ansible
sudo visudo

ansible ALL=(ALL) NOPASSWD:ALL

PowerShell (Administrador):
net user ansible 1 /add
net localgroup Administrators ansible /add

su - ansible
ssh-keygen -t rsa -b 4096 -C "ansible@controller"
ssh-copy-id ansible@172.185.29.172

winrm quickconfig
Enable-PSRemoting -Force
Set-Item -Path WSMan:\localhost\Service\Auth\Basic -Value $true
Set-Item -Path WSMan:\localhost\Service\AllowUnencrypted -Value $true


New-NetFirewallRule -Name "WinRM_TCP_IN"  -DisplayName "WinRM TCP Entrada"  -Protocol TCP -LocalPort 5985 -Direction Inbound  -Action Allow
New-NetFirewallRule -Name "WinRM_UDP_IN"  -DisplayName "WinRM UDP Entrada"  -Protocol UDP -LocalPort 5985 -Direction Inbound  -Action Allow
New-NetFirewallRule -Name "WinRM_TCP_OUT" -DisplayName "WinRM TCP Salida"   -Protocol TCP -LocalPort 5985 -Direction Outbound -Action Allow
New-NetFirewallRule -Name "WinRM_UDP_OUT" -DisplayName "WinRM UDP Salida"   -Protocol UDP -LocalPort 5985 -Direction Outbound -Action Allow

New-NetFirewallRule -DisplayName "Allow WinRM" -Name "AllowWinRM5985" -Protocol TCP -LocalPort 5985 -Action Allow


nano /etc/ansible/hosts
[linux]
172.185.29.172 ansible_user=ansible ansible_connection=ssh

[win]
10.0.0.24 ansible_user=ansible ansible_password=1 ansible_connection=winrm ansible_winrm_transport=basic ansible_port=5985

ansible linux -m ping -i /etc/ansible/hosts
ansible win -m win_ping -i /etc/ansible/hosts
======================================================================================================
======================================================================================================
Troubleshooting

Si el ping a windows no funciona:

sudo /usr/bin/python3.12 -m ensurepip --upgrade

/usr/bin/python3.12 -m pip --version

sudo /usr/bin/python3.12 -m pip install --upgrade pip setuptools wheel

sudo /usr/bin/python3.12 -m pip install pywinrm "pywinrm[credssp]" requests-ntlm xmltodict

/usr/bin/python3.12 -c "import winrm; print('winrm OK')"
