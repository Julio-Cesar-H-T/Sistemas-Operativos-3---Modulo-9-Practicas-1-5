Comandos utilizados, práctica laboratorio 9.5: Infraestructura como Código (IaC) y Automatización.

Uso de Playbooks en Ansible 
============================================

#Crear Playbook para instalar Notepad++ en Windows (ansible2)

#Crear el archivo del playbook:

sudo nano install_notepadpp.yml

>

- name: Instalar Notepad++ en Windows
  hosts: win
  tasks:
    - name: Descargar instalador de Notepad++
      win_get_url:
        url: https://github.com/notepad-plus-plus/notepad-plus-plus/releases/download/v8.6.8/npp.8.6.8.Installer.x64.exe
        dest: C:\\Users\\ansible\\Downloads\\npp_installer.exe

    - name: Instalar Notepad++
      win_package:
        path: C:\\Users\\ansible\\Downloads\\npp_installer.exe
        state: present
        arguments: /S


#Ejecutar el playbook:
ansible-playbook install_notepadpp.yml



#Crear Playbook para instalar NGINX en Linux (ansible1)

#Crear el archivo del playbook:

sudo nano install_nginx.yml
>
- name: Instalar NGINX en Linux
  hosts: linux
  become: true
  tasks:
    - name: Instalar nginx
      dnf:
        name: nginx
        state: present

    - name: Iniciar y habilitar nginx
      systemd:
        name: nginx
        enabled: true
        state: started

#Ejecutar el playbook:
ansible-playbook install_nginx.yml

#Verificar la instalación: Desde la VM cliente Linux:
sudo systemctl status nginx


=========================================================
EXTRA: Playbooks para crear users + instalar herramientas
=========================================================

nano create_user_and_install_bashtop.yml

>
- name: Crear usuario y agregarlo al grupo wheel + instalar bashtop
  hosts: linux
  become: true
  tasks:
    - name: Crear usuario adrian123
      user:
        name: adrian123
        state: present
        groups: wheel
        append: yes

    - name: Instalar bashtop
      dnf:
        name: bashtop
        state: present



ansible-playbook create_user_and_install_bashtop.yml

=================================================

=================================================

nano create_user_and_install_notepadpp.yml

>
- name: Crear usuario en Windows con permisos de administrador e instalar Notepad++
  hosts: win
  tasks:
    - name: Crear usuario adrian123
      win_user:
        name: adrian123
        password: "F07030409"
        state: present

    - name: Agregar usuario adrian123 al grupo Administradores
      win_group_membership:
        name: Administrators
        members:
          - adrian123
        state: present

    - name: Descargar instalador de Notepad++
      win_get_url:
        url: https://github.com/notepad-plus-plus/notepad-plus-plus/releases/download/v8.6.8/npp.8.6.8.Installer.x64.exe
        dest: C:\\Users\\ansible\\Downloads\\npp_installer.exe

    - name: Instalar Notepad++
      win_package:
        path: C:\\Users\\ansible\\Downloads\\npp_installer.exe
        state: present
        arguments: /S


ansible-playbook create_user_and_install_notepadpp.yml



---
- name: Crear usuario y agregarlo al grupo wheel + instalar bashtop
  hosts: linux
  become: true
  tasks:
    - name: Detectar y usar grupo correcto según distribución
      set_fact:
        grupo_sudo: "{{ 'wheel' if ansible_os_family == 'RedHat' else 'sudo' }}"

    - name: Crear usuario adrian123
      user:
        name: adrian123
        state: present
        groups: "{{ grupo_sudo }}"
        append: yes
        shell: /bin/bash
        create_home: yes

    - name: Instalar bashtop usando gestor de paquetes genérico
      package:
        name: bashtop
        state: present
      vars:
        ansible_package_manager:
          RedHat: dnf
          Debian: apt

    - name: Verificar si bashtop necesita EPEL en Rocky Linux
      block:
        - name: Instalar EPEL
          dnf:
            name: epel-release
            state: present
          when: ansible_distribution == "Rocky"
        
        - name: Reintentar instalación de bashtop con EPEL
          package:
            name: bashtop
            state: present
          when: 
            - ansible_os_family == "RedHat"
            - bashtop_instalado is not defined or not bashtop_instalado
      rescue:
        - debug:
            msg: "Bashtop no disponible en repositorios, instalando desde fuente..."
        
        - name: Instalar bashtop desde GitHub
          shell: |
            git clone https://github.com/aristocratos/bashtop.git /tmp/bashtop
            cd /tmp/bashtop
            sudo make install
          args:
            creates: /usr/local/bin/bashtop
          when: ansible_os_family != "Windows"
